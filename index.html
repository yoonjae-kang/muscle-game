<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ê·¼ìœ¡ í‚¤ìš°ê¸° ê²Œì„</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            width: 100vw;
            height: 100vh;
            overflow: hidden;
            background: #000;
        }

        #game-container {
            width: 100%;
            height: 100vh;
            position: relative;
            background: #f5f5f5;
        }

        #character-display {
            width: 100%;
            height: 100%;
            position: relative;
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
        }

        #start-screen {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        #start-screen h1 {
            color: white;
            font-size: 28px;
            margin-bottom: 20px;
            text-align: center;
            padding: 0 20px;
        }

        #start-screen p {
            color: #ddd;
            font-size: 16px;
            margin-bottom: 30px;
            text-align: center;
            padding: 0 20px;
        }

        .start-btn {
            padding: 15px 40px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 30px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
        }

        #level-display {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 5px 12px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: bold;
            z-index: 10;
            display: none;
        }

        #scenario-box {
            position: absolute;
            bottom: 90px;
            left: 10px;
            right: 10px;
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            padding: 15px;
            border-radius: 12px;
            box-shadow: 0 2px 15px rgba(0, 0, 0, 0.2);
            display: none;
        }

        #scenario-text {
            font-size: 15px;
            line-height: 1.4;
            margin-bottom: 8px;
            color: #000;
            font-weight: 600;
            text-shadow: 0 0 5px rgba(255, 255, 255, 0.9);
        }

        .choice-buttons {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .choice-btn {
            padding: 8px 12px;
            border: none;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            background: rgba(139, 115, 85, 0.7);
            color: white;
            font-weight: 500;
            text-align: left;
        }

        #stats-bar {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.85);
            padding: 6px;
            display: none;
            grid-template-columns: repeat(4, 1fr);
            gap: 4px;
            z-index: 10;
            height: 70px;
        }

        .stat-item {
            text-align: center;
            color: white;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .stat-label {
            font-size: 10px;
            opacity: 0.8;
            margin-bottom: 2px;
        }

        .stat-value {
            font-size: 13px;
            font-weight: bold;
        }

        .progress-bar {
            width: 100%;
            height: 3px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 2px;
            margin-top: 3px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: #4CAF50;
            transition: width 0.5s;
        }

        .progress-fill.danger {
            background: #f44336;
        }

        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            padding: 20px;
        }

        .overlay.show {
            display: flex;
        }

        .overlay.ending-overlay {
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
        }

        .result-box {
            background: white;
            padding: 25px;
            border-radius: 20px;
            text-align: center;
            max-width: 90%;
            width: 350px;
            position: relative;
            overflow: hidden;
        }

        .ending-box {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        .result-title {
            font-size: 22px;
            font-weight: bold;
            margin-bottom: 12px;
            color: #333;
        }

        .result-text {
            font-size: 15px;
            line-height: 1.5;
            margin-bottom: 18px;
            color: #666;
        }

        .btn {
            padding: 12px 30px;
            background: #8B7355;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 15px;
            cursor: pointer;
            margin: 5px;
            font-weight: bold;
        }

        .btn-green {
            background: #4CAF50;
        }

        .warning {
            background: rgba(255, 107, 107, 0.8);
            color: white;
            padding: 8px;
            border-radius: 6px;
            margin-bottom: 8px;
            font-weight: bold;
            font-size: 12px;
        }

        .level-up-effect {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 48px;
            font-weight: bold;
            color: #FFD700;
            z-index: 2000;
            animation: levelUp 1s ease-out forwards;
            pointer-events: none;
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.8);
        }

        @keyframes levelUp {
            0% { opacity: 0; transform: translate(-50%, -50%) scale(0.5); }
            50% { opacity: 1; transform: translate(-50%, -50%) scale(1.2); }
            100% { opacity: 0; transform: translate(-50%, -50%) scale(1.5); }
        }
    </style>
</head>
<body>
    <div id="game-container">
        <div id="character-display">
            <div id="start-screen">
                <h1>ğŸ’ª ê·¼ìœ¡ í‚¤ìš°ê¸° ê²Œì„</h1>
                <p>ìœ¤ì¬ê°€ ê±´ê°•í•œ ë³´ë””ë¹Œë”ê°€ ë˜ë„ë¡ ë„ì™€ì£¼ì„¸ìš”!</p>
                <button class="start-btn" onclick="startGame()">ê²Œì„ ì‹œì‘í•˜ê¸°</button>
            </div>
            
            <div id="level-display">LV.1 ìœ¤ì¬</div>
            <div id="scenario-box">
                <div id="scenario-text">ê²Œì„ì„ ì‹œì‘í•©ë‹ˆë‹¤...</div>
                <div class="choice-buttons" id="choices"></div>
            </div>
            <div id="stats-bar">
                <div class="stat-item">
                    <div class="stat-label">ê·¼ìœ¡ëŸ‰</div>
                    <div class="stat-value"><span id="muscle">20</span>kg</div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="muscle-bar"></div>
                    </div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">ì²´ì§€ë°©ë¥ </div>
                    <div class="stat-value"><span id="fat">33</span>%</div>
                    <div class="progress-bar">
                        <div class="progress-fill danger" id="fat-bar"></div>
                    </div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">ì˜ìš•</div>
                    <div class="stat-value"><span id="motivation">50</span></div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="motivation-bar"></div>
                    </div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">ë¬´ê¸°ë ¥</div>
                    <div class="stat-value"><span id="lethargy">0</span></div>
                    <div class="progress-bar">
                        <div class="progress-fill danger" id="lethargy-bar"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="overlay" id="result-overlay">
        <div class="result-box">
            <h2 class="result-title" id="result-title">ê²°ê³¼</h2>
            <p class="result-text" id="result-text">í…ìŠ¤íŠ¸</p>
            <button class="btn" onclick="hideResult()">ê³„ì†í•˜ê¸°</button>
        </div>
    </div>

    <div class="overlay ending-overlay" id="ending-overlay">
        <div class="result-box ending-box">
            <h2 class="result-title" id="ending-title">ì—”ë”©</h2>
            <p class="result-text" id="ending-text">í…ìŠ¤íŠ¸</p>
            <button class="btn btn-green" onclick="location.reload()">ë‹¤ì‹œ ì‹œì‘</button>
        </div>
    </div>

    <script>
const gameState = {
    level: 1,
    muscle: 20,
    fat: 33,
    motivation: 50,
    lethargy: 0,
    currentScenario: 0,
    specialPath: null,
    specialStep: 0,
    goodChoices: 0,
    lastSpecialChoice: null,
    surgeryEventShown: false,
    drugEventShown: false
};

const characterImages = {
    1: 'https://i.imgur.com/rHDox3L.png',
    7: 'https://i.imgur.com/wPCS6fA.png',
    13: 'https://i.imgur.com/yea3RHW.png',
    18: 'https://i.imgur.com/bA6xX7Q.jpeg'
};

const scenarios = [
    {
        text: "ë°¤ 10ì‹œ, ì˜¤ëŠ˜ ìš´ë™ì„ ë¹¼ë¨¹ì—ˆë‹¤ëŠ” ê±¸ ê¹¨ë‹¬ì•˜ì–´ìš”. í”¼ê³¤í•˜ì§€ë§Œ í—¬ìŠ¤ì¥ì€ ì•„ì§ ì—´ë ¤ìˆì–´ìš”.",
        choices: [
            { text: "í”¼ê³¤í•´ë„ ìš´ë™í•˜ëŸ¬ ê°€ê¸°", muscle: 0.8, fat: -0.8, motivation: 15, lethargy: -1, good: true },
            { text: "ì˜¤ëŠ˜ì€ ì‰¬ê³  ë‚´ì¼ ë” ì—´ì‹¬íˆ", muscle: -0.3, fat: 0.4, motivation: -5, lethargy: 2, bad: true },
            { text: "ì§‘ì—ì„œ í™ˆíŠ¸ë ˆì´ë‹í•˜ê¸°", muscle: 0.5, fat: -0.4, motivation: 8, lethargy: 0 }
        ]
    },
    {
        text: "ì¹œêµ¬ë“¤ì´ ì¹˜í‚¨ê³¼ ë§¥ì£¼ íŒŒí‹°ë¥¼ í•˜ìê³  í•´ìš”. í•˜ì§€ë§Œ ë‹¤ì´ì–´íŠ¸ ì¤‘ì´ì—ìš”.",
        choices: [
            { text: "ë‹­ê°€ìŠ´ì‚´ ë„ì‹œë½ ì‹¸ê°€ê¸°", muscle: 0.7, fat: -0.9, motivation: 10, lethargy: -1, good: true },
            { text: "í•œ ë²ˆì¯¤ì€ ê´œì°®ì•„! ì¦ê¸°ê¸°", muscle: -0.5, fat: 1.2, motivation: -15, lethargy: 3, bad: true },
            { text: "ì†ŒëŸ‰ë§Œ ë¨¹ê³  ìš´ë™ìœ¼ë¡œ ë³´ì¶©", muscle: 0.2, fat: 0.3, motivation: 0, lethargy: 1 }
        ]
    },
    {
        text: "ìƒˆë²½ 5ì‹œ ì•ŒëŒì´ ìš¸ë ¤ìš”. ì˜¤ëŠ˜ì€ í•˜ì²´ ìš´ë™í•˜ëŠ” ë‚ ì´ì—ìš”.",
        choices: [
            { text: "ë°”ë¡œ ì¼ì–´ë‚˜ì„œ ìš´ë™ ì¤€ë¹„", muscle: 1.0, fat: -1.0, motivation: 20, lethargy: -2, good: true },
            { text: "30ë¶„ë§Œ ë” ìê³  ì¼ì–´ë‚˜ê¸°", muscle: 0.4, fat: -0.4, motivation: 5, lethargy: 1 },
            { text: "ì˜¤ëŠ˜ì€ ê±´ë„ˆë›°ê³  ë” ìê¸°", muscle: -0.6, fat: 0.6, motivation: -20, lethargy: 4, bad: true }
        ]
    },
    {
        text: "PT íŠ¸ë ˆì´ë„ˆê°€ ì‹ë‹¨ì„ ë” ì—„ê²©í•˜ê²Œ ì§€í‚¤ë¼ê³  í•´ìš”. í•˜ì§€ë§Œ ë„ˆë¬´ í˜ë“¤ì–´ìš”.",
        choices: [
            { text: "ì™„ë²½í•˜ê²Œ ì§€í‚¤ê¸°ë¡œ ê²°ì‹¬", muscle: 1.2, fat: -1.2, motivation: 15, lethargy: -1, good: true },
            { text: "80% ì •ë„ë§Œ ì§€í‚¤ê¸°", muscle: 0.6, fat: -0.6, motivation: 8, lethargy: 0 },
            { text: "ë„ˆë¬´ ìŠ¤íŠ¸ë ˆìŠ¤ ë°›ì•„ì„œ í¬ê¸°", muscle: -0.8, fat: 1.0, motivation: -25, lethargy: 5, bad: true }
        ]
    },
    {
        text: "ê°€ìŠ´ ìš´ë™í•˜ëŠ” ë‚ , ë²¤ì¹˜í”„ë ˆìŠ¤ë¥¼ í•˜ë‹¤ê°€ ë°”ë²¨ì— ê¹”ë ¸ì–´ìš”! ë‹¤ë“¤ ì³ë‹¤ë³´ê³  ìˆì–´ìš”.",
        choices: [
            { text: "í„¸ê³  ì¼ì–´ë‚˜ì„œ ìš´ë™ ê³„ì†í•˜ê¸°", muscle: 1.0, fat: -0.7, motivation: 20, lethargy: -2, good: true },
            { text: "ë¶€ë„ëŸ¬ì›Œì„œ ì§‘ìœ¼ë¡œ ë„ë§ì¹˜ê¸°", muscle: -0.5, fat: 0.2, motivation: -30, lethargy: 4, bad: true },
            { text: "ì•ˆ ê¹”ë¦° ì²™ ë°”ë‹¥ì— ëˆ„ì›Œ ìëŠ” ì²™í•˜ê¸°", muscle: 0, fat: 0.5, motivation: -15, lethargy: 3 }
        ]
    },
    {
        text: "ì˜¤ëŠ˜ ì•„ì¹¨ ê±°ìš¸ì„ ë´¤ëŠ”ë° ëˆˆë°”ë””ê°€ ë§ˆìŒì— ì•ˆ ë“¤ì–´ìš”. ì‚´ì´ ì° ê²ƒ ê°™ì•„ìš”.",
        choices: [
            { text: "í•˜ë£¨ì¢…ì¼ ì—´ì‹¬íˆ ì‹ë‹¨í•˜ê³  ì›€ì§ì´ê¸°", muscle: 0.9, fat: -1.0, motivation: 15, lethargy: -1, good: true },
            { text: "ì—ë¼ ëª¨ë¥´ê² ë‹¤! ì˜¤ëŠ˜ì€ ì¹˜íŒ… ë°ì´", muscle: -0.4, fat: 1.5, motivation: -20, lethargy: 4, bad: true },
            { text: "ì¼ë‹¨ ê°ë„ ë§ì¶°ì„œ ì¸ìŠ¤íƒ€ìš© ì‚¬ì§„ ì°ê¸°", muscle: 0.1, fat: 0.2, motivation: 5, lethargy: 1 }
        ]
    },
    {
        text: "ìƒˆë²½ 2ì‹œ, ë„·í”Œë¦­ìŠ¤ ì‹œë¦¬ì¦ˆê°€ ë„ˆë¬´ ì¬ë°Œì–´ìš”! ë‚´ì¼ ì•„ì¹¨ ìš´ë™ì´ ìˆëŠ”ë°...",
        choices: [
            { text: "ë°”ë¡œ ë„ê³  ìì„œ ì¶©ë¶„í•œ ìˆ˜ë©´ ì·¨í•˜ê¸°", muscle: 0.7, fat: -0.6, motivation: 15, lethargy: -2, good: true },
            { text: "ì‹œë¦¬ì¦ˆ ì •ì£¼í–‰í•˜ë©° ë°¤ìƒˆê¸°", muscle: -0.6, fat: 0.8, motivation: -25, lethargy: 5, bad: true },
            { text: "í•œ í¸ë§Œ ë” ë³´ê³  ìê¸°", muscle: 0.2, fat: 0.1, motivation: -5, lethargy: 2 }
        ]
    },
    {
        text: "ë³´ì¶©ì œë¥¼ ì‚¬ì•¼ í•  ì‹œê¸°ê°€ ì™”ì–´ìš”. ê·¼ìœ¡ ì„±ì¥ì— ë„ì›€ì´ ë ê¹Œìš”?",
        choices: [
            { text: "í’ˆì§ˆ ì¢‹ì€ í”„ë¡œí‹´ íŒŒìš°ë” êµ¬ë§¤í•˜ê¸°", muscle: 1.1, fat: -0.5, motivation: 15, lethargy: -1, good: true },
            { text: "ë‹¨ë°±ì§ˆ ì±™ê²¨ë¨¹ê¸° ë„ˆë¬´ ê·€ì°®ì•„", muscle: -0.7, fat: 0.6, motivation: -20, lethargy: 3, bad: true },
            { text: "ì¼ë‹¨ ìì—°ì‹ìœ¼ë¡œ ë‹¨ë°±ì§ˆ ì„­ì·¨í•˜ê¸°", muscle: 0.5, fat: -0.2, motivation: 8, lethargy: 0 }
        ]
    },
    {
        text: "ì½œë¡ì½œë¡... ì˜¤ëŠ˜ì€ ì»¨ë””ì…˜ì´ ë³„ë¡œì˜ˆìš”. ëª©ë„ ì•„í”„ê³  ëª¸ë„ ë¬´ê±°ì›Œìš”.",
        choices: [
            { text: "í‰ì†Œì²˜ëŸ¼ ê³ ê°•ë„ë¡œ ë°€ì–´ë¶™ì´ê¸°", muscle: -0.3, fat: 0.2, motivation: -10, lethargy: 4, bad: true },
            { text: "ì»¨ë””ì…˜ì— ë§ì¶° ê°€ë²¼ìš´ ìš´ë™í•˜ê¸°", muscle: 0.4, fat: -0.3, motivation: 10, lethargy: -1, good: true },
            { text: "ìš´ë™ ëŒ€ì‹  ê±°ìš¸ ì•ì—ì„œ í¬ì¦ˆë§Œ ì·¨í•˜ê¸°", muscle: 0, fat: 0.4, motivation: -5, lethargy: 2 }
        ]
    }
];

const specialScenarios = {
    surgery: {
        step1: {
            text: "ì¸ìŠ¤íƒ€ê·¸ë¨ì—ì„œ ì„±í˜•ìœ¼ë¡œ ì™„ë²½í•œ ëª¸ë§¤ë¥¼ ë§Œë“  ì¸í”Œë£¨ì–¸ì„œë¥¼ ë´¤ì–´ìš”.",
            warning: true,
            choices: [
                { text: "ì„±í˜•ìˆ˜ìˆ ë¡œ ë¹ ë¥¸ ê²°ê³¼ ì–»ê¸° ğŸ’€", special: 'surgery', muscle: 3, fat: -6, motivation: 40, lethargy: -5 },
                { text: "ìì—°ìŠ¤ëŸ½ê²Œ ìš´ë™ìœ¼ë¡œ ë§Œë“¤ê¸°", muscle: 0.8, fat: -0.8, motivation: 15, lethargy: -1, good: true },
                { text: "ë” ìì„¸íˆ ì•Œì•„ë³´ê¸°", muscle: 0, fat: 0, motivation: 5, lethargy: 0 }
            ]
        },
        step2: {
            text: "ìˆ˜ìˆ ì€ ì„±ê³µì ì´ì—ˆì–´ìš”! ì¸ìŠ¤íƒ€ê·¸ë¨ íŒ”ë¡œì›Œê°€ 10ë§Œëª…ì´ ë„˜ì—ˆì–´ìš”. í•˜ì§€ë§Œ ê°€ìŠ´ì´ ì´ìƒí•˜ê²Œ ì•„íŒŒìš”...",
            choices: [
                { text: "ë³‘ì›ì— ê°€ì„œ ê²€ì‚¬ë°›ê¸°", result: 'late' },
                { text: "ì§„í†µì œ ë¨¹ê³  ì°¸ê¸°", result: 'worse' }
            ]
        },
        step3_late: {
            text: "ì˜ì‚¬ê°€ ì‹¬ê°í•œ í‘œì •ìœ¼ë¡œ ë§í•´ìš”. 'ë³´í˜•ë¬¼ì— ë¬¸ì œê°€ ìƒê²¼ì–´ìš”. ì¦‰ì‹œ ì œê±° ìˆ˜ìˆ ì´ í•„ìš”í•©ë‹ˆë‹¤.'",
            choices: [
                { text: "ë¹šì„ ë‚´ì„œë¼ë„ ìˆ˜ìˆ ë°›ê¸°", result: 'poor_end' }
            ]
        },
        step3_worse: {
            text: "ê³ í†µì´ ì ì  ì‹¬í•´ì ¸ìš”. ë³´í˜•ë¬¼ì´ í„°ì§„ ê²ƒ ê°™ì•„ìš”. ì‘ê¸‰ì‹¤ë¡œ ì‹¤ë ¤ê°”ì§€ë§Œ...",
            choices: []
        }
    },
    drug: {
        step1: {
            text: "í—¬ìŠ¤ì¥ì—ì„œ ë§Œë‚œ ì„ ë°°ê°€ ì•½ë¬¼ì„ ê¶Œí•´ìš”. 'ì´ê±° ë¨¹ìœ¼ë©´ 3ê°œì›” ì•ˆì— ëŒ€íšŒ ë‚˜ê°ˆ ìˆ˜ ìˆì–´.'",
            warning: true,
            choices: [
                { text: "ì•½ë¬¼ë¡œ ë¹ ë¥¸ ê·¼ìœ¡ ì¦ê°€ ğŸ’€", special: 'drug', muscle: 6, fat: -10, motivation: 60, lethargy: -8 },
                { text: "ìì—°ì ì¸ ë°©ë²• ê³ ìˆ˜í•˜ê¸°", muscle: 1.0, fat: -0.8, motivation: 15, lethargy: -1, good: true },
                { text: "ë¶€ì‘ìš©ì— ëŒ€í•´ ë¬¼ì–´ë³´ê¸°", muscle: 0, fat: 0, motivation: 5, lethargy: 0 }
            ]
        },
        step2: {
            text: "ë³´ë””ë¹Œë”© ëŒ€íšŒì—ì„œ ìš°ìŠ¹í–ˆì–´ìš”! í•˜ì§€ë§Œ ìµœê·¼ ì‹¬ì¥ì´ ì´ìƒí•˜ê²Œ ë›°ê³ , ë¨¸ë¦¬ì¹´ë½ì´ ë¹ ì§€ê¸° ì‹œì‘í–ˆì–´ìš”...",
            choices: [
                { text: "ì•½ë¬¼ ì¤‘ë‹¨í•˜ê³  ë³‘ì› ê°€ê¸°", result: 'late' },
                { text: "ì¡°ê¸ˆë§Œ ë” ì‚¬ìš©í•˜ê¸°", result: 'worse' }
            ]
        },
        step3_late: {
            text: "ì˜ì‚¬ì˜ ì§„ë‹¨ì´ ì¶©ê²©ì ì´ì—ìš”. 'ê°„ê³¼ ì‹ ì¥ì´ ì‹¬ê°í•˜ê²Œ ì†ìƒëìŠµë‹ˆë‹¤.'",
            choices: [
                { text: "ì¹˜ë£Œì— ì „ë…í•˜ê¸°", result: 'sick_end' }
            ]
        },
        step3_worse: {
            text: "ëª¸ì´ ê¸‰ê²©íˆ ë¬´ë„ˆì§€ê¸° ì‹œì‘í–ˆì–´ìš”. ê·¼ìœ¡ì€ ë…¹ì•„ë‚´ë¦¬ê³ , ì¥ê¸°ë“¤ì´ í•˜ë‚˜ë‘˜ ê¸°ëŠ¥ì„ ë©ˆì¶°ê°€ìš”...",
            choices: []
        }
    }
};

function shuffleChoices(choices) {
    const shuffled = [...choices];
    for (let i = shuffled.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
    }
    return shuffled;
}

function startGame() {
    document.getElementById('start-screen').style.display = 'none';
    document.getElementById('level-display').style.display = 'block';
    document.getElementById('scenario-box').style.display = 'block';
    document.getElementById('stats-bar').style.display = 'grid';
    updateStats();
    showScenario();
}

function updateCharacterImage() {
    const display = document.getElementById('character-display');
    let imageUrl;
    
    if (gameState.level >= 18) imageUrl = characterImages[18];
    else if (gameState.level >= 13) imageUrl = characterImages[13];
    else if (gameState.level >= 7) imageUrl = characterImages[7];
    else imageUrl = characterImages[1];
    
    display.style.backgroundImage = `url('${imageUrl}')`;
}

function showLevelUpEffect() {
    const effect = document.createElement('div');
    effect.className = 'level-up-effect';
    effect.textContent = 'LEVEL UP!';
    document.body.appendChild(effect);
    
    setTimeout(() => {
        effect.remove();
    }, 1000);
}

function updateStats() {
    document.getElementById('muscle').textContent = gameState.muscle.toFixed(1);
    document.getElementById('fat').textContent = gameState.fat.toFixed(1);
    document.getElementById('motivation').textContent = Math.round(gameState.motivation);
    document.getElementById('lethargy').textContent = Math.round(gameState.lethargy);

    document.getElementById('muscle-bar').style.width = (gameState.muscle / 38 * 100) + '%';
    document.getElementById('fat-bar').style.width = (gameState.fat / 33 * 100) + '%';
    document.getElementById('motivation-bar').style.width = gameState.motivation + '%';
    document.getElementById('lethargy-bar').style.width = (gameState.lethargy * 10) + '%';
    
    const oldLevel = gameState.level;
    
    if (gameState.goodChoices > 0) {
        gameState.level = Math.min(22, gameState.level + 1);
        gameState.goodChoices = 0;
        
        if (gameState.level > oldLevel) {
            showLevelUpEffect();
        }
    }
    
    document.getElementById('level-display').textContent = 'LV.' + gameState.level + ' ìœ¤ì¬';
    updateCharacterImage();
}

function showScenario() {
    if (gameState.lethargy >= 10) {
        showEnding('ë¬´ê¸°ë ¥ ì—”ë”© ğŸ˜”', 'ë¬´ê¸°ë ¥ì— ë¹ ì ¸ ë³´ë””ë¹Œë”©ì„ í¬ê¸°í–ˆì–´ìš”.');
        return;
    }
    if (gameState.motivation <= 0) {
        showEnding('í¬ê¸° ì—”ë”© ğŸ˜¢', 'ì˜ìš•ì„ ì™„ì „íˆ ìƒì–´ë²„ë ¸ì–´ìš”.');
        return;
    }
    if (gameState.level >= 18) {
        showEnding('ë³´ë””ë¹Œë” ì„±ê³µ! ğŸ†', 'ìœ¤ì¬ëŠ” ê±´ê°•í•œ ë°©ë²•ìœ¼ë¡œ ì™„ë²½í•œ ëª¸ì„ ë§Œë“¤ì—ˆì–´ìš”!');
        return;
    }

    let scenario;
    
    if (gameState.specialPath) {
        if (gameState.specialPath === 'surgery') {
            if (gameState.specialStep === 1) {
                scenario = specialScenarios.surgery.step2;
            } else if (gameState.specialStep === 2) {
                scenario = gameState.lastSpecialChoice === 'late' 
                    ? specialScenarios.surgery.step3_late 
                    : specialScenarios.surgery.step3_worse;
            }
        } else if (gameState.specialPath === 'drug') {
            if (gameState.specialStep === 1) {
                scenario = specialScenarios.drug.step2;
            } else if (gameState.specialStep === 2) {
                scenario = gameState.lastSpecialChoice === 'late' 
                    ? specialScenarios.drug.step3_late 
                    : specialScenarios.drug.step3_worse;
            }
        }
        gameState.specialStep++;
    } else {
        if (gameState.level === 7 && Math.random() > 0.5) {
            scenario = specialScenarios.surgery.step1;
        } else if (gameState.level === 18 && Math.random() > 0.5) {
            scenario = specialScenarios.drug.step1;
        } else {
            scenario = scenarios[gameState.currentScenario];
            gameState.currentScenario = (gameState.currentScenario + 1) % scenarios.length;
        }
    }

    const textDiv = document.getElementById('scenario-text');
    if (scenario.warning) {
        textDiv.innerHTML = '<div class="warning">âš ï¸ ìœ„í—˜í•œ ì„ íƒì…ë‹ˆë‹¤!</div>' + scenario.text;
    } else {
        textDiv.textContent = scenario.text;
    }

    const choicesDiv = document.getElementById('choices');
    choicesDiv.innerHTML = '';
    
    if (scenario.choices.length === 0) {
        setTimeout(() => {
            if (gameState.specialPath === 'surgery') {
                showEnding('ìˆ˜ìˆ  í•©ë³‘ì¦ ì‚¬ë§ ğŸ’€', 'ë³´í˜•ë¬¼ ê´€ë¦¬ë¥¼ ì œëŒ€ë¡œ í•˜ì§€ ëª»í•´ íŒ¨í˜ˆì¦ìœ¼ë¡œ ì‚¬ë§í–ˆìŠµë‹ˆë‹¤.');
            } else if (gameState.specialPath === 'drug') {
                showEnding('ì•½ë¬¼ ë¶€ì‘ìš© ì‚¬ë§ ğŸ’€', 'ì•½ë¬¼ ë¶€ì‘ìš©ìœ¼ë¡œ ì¥ê¸°ê°€ ë§ê°€ì ¸ ì‚¬ë§í–ˆìŠµë‹ˆë‹¤.');
            }
        }, 2000);
        return;
    }
    
    const shuffledChoices = shuffleChoices(scenario.choices);
    
    shuffledChoices.forEach(choice => {
        const btn = document.createElement('button');
        btn.className = 'choice-btn';
        btn.textContent = choice.text;
        btn.onclick = () => handleChoice(choice);
        choicesDiv.appendChild(btn);
    });
}

function handleChoice(choice) {
    if (choice.special) {
        gameState.specialPath = choice.special;
        gameState.specialStep = 1;
    }

    if (choice.result) {
        gameState.lastSpecialChoice = choice.result;
        
        if (choice.result === 'poor_end') {
            showResult('ë¹šë”ë¯¸', 'ìˆ˜ìˆ ì€ ì„±ê³µí–ˆì§€ë§Œ ê±°ì•¡ì˜ ë¹šì„ ì§€ê²Œ ë˜ì—ˆì–´ìš”...', () => {
                showEnding('íŒŒì‚° ì—”ë”©', 'ì„±í˜•ìˆ˜ìˆ ì˜ ëŒ€ê°€ë¡œ ëª¨ë“  ê²ƒì„ ìƒì—ˆìŠµë‹ˆë‹¤.');
            });
            return;
        } else if (choice.result === 'sick_end') {
            showResult('íˆ¬ë³‘ ìƒí™œ', 'ì•½ë¬¼ ë¶€ì‘ìš©ìœ¼ë¡œ í‰ìƒ íˆ¬ë³‘í•˜ë©° ì‚´ì•„ê°€ê²Œ ë˜ì—ˆì–´ìš”...', () => {
                showEnding('ê±´ê°• ìƒì‹¤ ì—”ë”©', 'ì•½ë¬¼ì˜ ëŒ€ê°€ëŠ” ë„ˆë¬´ ì»¸ìŠµë‹ˆë‹¤.');
            });
            return;
        }
    }

    if (choice.good) {
        gameState.goodChoices++;
    }

    gameState.muscle = Math.max(20, Math.min(38, gameState.muscle + (choice.muscle || 0)));
    gameState.fat = Math.max(7, Math.min(33, gameState.fat + (choice.fat || 0)));
    gameState.motivation = Math.max(0, Math.min(100, gameState.motivation + (choice.motivation || 0)));
    gameState.lethargy = Math.max(0, Math.min(10, gameState.lethargy + (choice.lethargy || 0)));

    updateStats();

    if (gameState.specialPath) {
        if (choice.special) {
            showResult('ìœ„í—˜í•œ ì„ íƒ...', 'ëŒì´í‚¬ ìˆ˜ ì—†ëŠ” ê¸¸ì„ ì„ íƒí–ˆìŠµë‹ˆë‹¤.', () => {
                setTimeout(showScenario, 300);
            });
        } else if (choice.result) {
            setTimeout(showScenario, 500);
        } else {
            showResult('ê²°ê³¼', 'ì„ íƒì˜ ê²°ê³¼ê°€ ë‚˜íƒ€ë‚¬ìŠµë‹ˆë‹¤.', () => {
                setTimeout(showScenario, 300);
            });
        }
        return;
    }

    let title = 'ê²°ê³¼';
    let text = '';
    
    if (choice.good) {
        title = 'í›Œë¥­í•œ ì„ íƒ! ğŸ’ªâœ¨';
        text = 'ê·¼ìœ¡ì´ ë¹ ë¥´ê²Œ ì„±ì¥í•˜ê³  ìˆì–´ìš”! ë ˆë²¨ì´ ì˜¬ëìŠµë‹ˆë‹¤!';
    } else if (choice.bad) {
        title = 'ì•„ì‰¬ìš´ ì„ íƒ ğŸ˜”';
        text = 'ë” ì¢‹ì€ ì„ íƒì„ í•  ìˆ˜ ìˆì—ˆì–´ìš”.';
    } else {
        title = 'ê´œì°®ì€ ì„ íƒ ğŸ‘';
        text = 'ì¡°ê¸ˆì”© ë°œì „í•˜ê³  ìˆì–´ìš”.';
    }

    showResult(title, text);
}

function showResult(title, text, callback) {
    document.getElementById('result-title').textContent = title;
    document.getElementById('result-text').textContent = text;
    document.getElementById('result-overlay').classList.add('show');
    
    window.resultCallback = callback;
}

function hideResult() {
    document.getElementById('result-overlay').classList.remove('show');
    if (window.resultCallback) {
        window.resultCallback();
        window.resultCallback = null;
    } else if (!gameState.specialPath) {
        setTimeout(showScenario, 300);
    }
}

function showEnding(title, text) {
    document.getElementById('ending-title').textContent = title;
    document.getElementById('ending-text').textContent = text;
    
    const endingOverlay = document.getElementById('ending-overlay');
    
    // íŠ¹ë³„ ì—”ë”© ë°°ê²½ ì´ë¯¸ì§€ ì„¤ì • - ì „ì²´ í™”ë©´ì— í‘œì‹œ
    if (title.includes('ìˆ˜ìˆ ') || title.includes('ì„±í˜•') || title.includes('íŒŒì‚°')) {
        // ìˆ˜ìˆ  ê´€ë ¨ ì—”ë”©
        endingOverlay.style.backgroundImage = `url('https://i.imgur.com/sKpOMgJ.png')`;
    } else if (title.includes('ì•½ë¬¼') || title.includes('ê±´ê°• ìƒì‹¤')) {
        // ì•½ë¬¼ ê´€ë ¨ ì—”ë”©
        endingOverlay.style.backgroundImage = `url('https://i.imgur.com/9M8uEKl.jpeg')`;
    } else if (title.includes('ì„±ê³µ')) {
        // ì„±ê³µ ì—”ë”©
        endingOverlay.style.backgroundImage = `url('${characterImages[18]}')`;
    } else {
        // ì¼ë°˜ ì—”ë”© - ê²€ì€ ë°°ê²½
        endingOverlay.style.backgroundImage = 'none';
        endingOverlay.style.backgroundColor = 'rgba(0, 0, 0, 0.8)';
    }
    
    endingOverlay.classList.add('show');
}
    </script>
</body>
</html>